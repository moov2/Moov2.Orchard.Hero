/*
** NOTE: This file is generated by Gulp and should not be edited directly!
** Any changes made directly to this file will be overwritten next time its asset group is processed by Gulp.
*/

(function () {
    var CONTENT_TYPE_IMAGE = 'Image',
        SIZES_URL = '/Admin/Hero/Sizes';

    var $openMediaBtn = $('.js-open-media-library'),
        $breakpoints = $('.js-hero-breakpoints'),
        $input = $('#Hero_Text');

    var addListeners = function () {
        $openMediaBtn.on('click', openMediaPicker);
    };

    /**
     * Opens media picker, content editor can select a media from library, which
     * is then used to generate HTML.
     */
    var openMediaPicker = function () {
        var adminIndex = location.href.toLowerCase().indexOf('/admin/'),
            cachedScrollPosition = 0;

        if (adminIndex === -1) {
            return false;
        }

        $.colorbox({
            href: location.href.substr(0, adminIndex) + '/Admin/Orchard.MediaLibrary?dialog=true',
            iframe: true,
            reposition: true,
            width: '90%',
            height: '90%',
            onLoad: function () {
                cachedScrollPosition = $('html').scrollTop();
                // hide the scrollbars from the main window
                $('html, body').css('overflow', 'hidden');
            },
            onClosed: function () {
                $('html, body').css('overflow', '');
                $('html').scrollTop(cachedScrollPosition);
                console.log(cachedScrollPosition);
                setHtml($.colorbox.selectedData);
            }
        });

        return false;
    };

    /**
     * Returns HTML for a single image.
     */
    var renderSingleImage = function (image, onRenderHtml) {
        var html = '<section class="hero">\n',
            url = SIZES_URL + '?id=' + image.id + '&breakpoints=' + $breakpoints.val();

        $.ajax({
            url: url
        })
        .done(function(data) {
            var largestImage = data[data.length - 1];
            var imageElement = '<img sizes="(max-width: ' + largestImage.Size + 'px) 100vw, ' + largestImage.Size + 'px"';
            
            imageElement += '\n\t\tsrcset="';
            
            for (var i = 0; i < data.length; i++) {
                imageElement += '\n\t\t\t' + data[i].Url + ' ' + data[i].Size + 'w';

                if (i < (data.length - 1)) {
                    imageElement += ',';
                }
            }
            
            imageElement += '"';
            imageElement += '\n\t\tsrc="' + largestImage.Url + '" alt="' + image.alternateText + '" />';
            
            html += '\t' + imageElement;
            html += '\n</section>';
            onRenderHtml(html);
        });
    };

    /**
     * Uses selected media to set HTML.
     */
    var setHtml = function (media) {
        if (!media || media.length === 0) {
            return;
        }

        var onRenderHtml = function (html) {
            $input.val(html);
            $input[0].dispatchEvent(new Event('change'));
        };

        if (media.length === 1 && media[0].contentType === CONTENT_TYPE_IMAGE) {
            renderSingleImage(media[0], onRenderHtml);
        }
    };

    addListeners();
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm9yY2hhcmQuaGVyby5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQUFMQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoib3JjaGFyZC5oZXJvLmpzIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uICgpIHtcclxuICAgIHZhciBDT05URU5UX1RZUEVfSU1BR0UgPSAnSW1hZ2UnLFxyXG4gICAgICAgIFNJWkVTX1VSTCA9ICcvQWRtaW4vSGVyby9TaXplcyc7XHJcblxyXG4gICAgdmFyICRvcGVuTWVkaWFCdG4gPSAkKCcuanMtb3Blbi1tZWRpYS1saWJyYXJ5JyksXHJcbiAgICAgICAgJGJyZWFrcG9pbnRzID0gJCgnLmpzLWhlcm8tYnJlYWtwb2ludHMnKSxcclxuICAgICAgICAkaW5wdXQgPSAkKCcjSGVyb19UZXh0Jyk7XHJcblxyXG4gICAgdmFyIGFkZExpc3RlbmVycyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAkb3Blbk1lZGlhQnRuLm9uKCdjbGljaycsIG9wZW5NZWRpYVBpY2tlcik7XHJcbiAgICB9O1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogT3BlbnMgbWVkaWEgcGlja2VyLCBjb250ZW50IGVkaXRvciBjYW4gc2VsZWN0IGEgbWVkaWEgZnJvbSBsaWJyYXJ5LCB3aGljaFxyXG4gICAgICogaXMgdGhlbiB1c2VkIHRvIGdlbmVyYXRlIEhUTUwuXHJcbiAgICAgKi9cclxuICAgIHZhciBvcGVuTWVkaWFQaWNrZXIgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIGFkbWluSW5kZXggPSBsb2NhdGlvbi5ocmVmLnRvTG93ZXJDYXNlKCkuaW5kZXhPZignL2FkbWluLycpLFxyXG4gICAgICAgICAgICBjYWNoZWRTY3JvbGxQb3NpdGlvbiA9IDA7XHJcblxyXG4gICAgICAgIGlmIChhZG1pbkluZGV4ID09PSAtMSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAkLmNvbG9yYm94KHtcclxuICAgICAgICAgICAgaHJlZjogbG9jYXRpb24uaHJlZi5zdWJzdHIoMCwgYWRtaW5JbmRleCkgKyAnL0FkbWluL09yY2hhcmQuTWVkaWFMaWJyYXJ5P2RpYWxvZz10cnVlJyxcclxuICAgICAgICAgICAgaWZyYW1lOiB0cnVlLFxyXG4gICAgICAgICAgICByZXBvc2l0aW9uOiB0cnVlLFxyXG4gICAgICAgICAgICB3aWR0aDogJzkwJScsXHJcbiAgICAgICAgICAgIGhlaWdodDogJzkwJScsXHJcbiAgICAgICAgICAgIG9uTG9hZDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgY2FjaGVkU2Nyb2xsUG9zaXRpb24gPSAkKCdodG1sJykuc2Nyb2xsVG9wKCk7XHJcbiAgICAgICAgICAgICAgICAvLyBoaWRlIHRoZSBzY3JvbGxiYXJzIGZyb20gdGhlIG1haW4gd2luZG93XHJcbiAgICAgICAgICAgICAgICAkKCdodG1sLCBib2R5JykuY3NzKCdvdmVyZmxvdycsICdoaWRkZW4nKTtcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgb25DbG9zZWQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICQoJ2h0bWwsIGJvZHknKS5jc3MoJ292ZXJmbG93JywgJycpO1xyXG4gICAgICAgICAgICAgICAgJCgnaHRtbCcpLnNjcm9sbFRvcChjYWNoZWRTY3JvbGxQb3NpdGlvbik7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhjYWNoZWRTY3JvbGxQb3NpdGlvbik7XHJcbiAgICAgICAgICAgICAgICBzZXRIdG1sKCQuY29sb3Jib3guc2VsZWN0ZWREYXRhKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9O1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogUmV0dXJucyBIVE1MIGZvciBhIHNpbmdsZSBpbWFnZS5cclxuICAgICAqL1xyXG4gICAgdmFyIHJlbmRlclNpbmdsZUltYWdlID0gZnVuY3Rpb24gKGltYWdlLCBvblJlbmRlckh0bWwpIHtcclxuICAgICAgICB2YXIgaHRtbCA9ICc8c2VjdGlvbiBjbGFzcz1cImhlcm9cIj5cXG4nLFxyXG4gICAgICAgICAgICB1cmwgPSBTSVpFU19VUkwgKyAnP2lkPScgKyBpbWFnZS5pZCArICcmYnJlYWtwb2ludHM9JyArICRicmVha3BvaW50cy52YWwoKTtcclxuXHJcbiAgICAgICAgJC5hamF4KHtcclxuICAgICAgICAgICAgdXJsOiB1cmxcclxuICAgICAgICB9KVxyXG4gICAgICAgIC5kb25lKGZ1bmN0aW9uKGRhdGEpIHtcclxuICAgICAgICAgICAgdmFyIGxhcmdlc3RJbWFnZSA9IGRhdGFbZGF0YS5sZW5ndGggLSAxXTtcclxuICAgICAgICAgICAgdmFyIGltYWdlRWxlbWVudCA9ICc8aW1nIHNpemVzPVwiKG1heC13aWR0aDogJyArIGxhcmdlc3RJbWFnZS5TaXplICsgJ3B4KSAxMDB2dywgJyArIGxhcmdlc3RJbWFnZS5TaXplICsgJ3B4XCInO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgaW1hZ2VFbGVtZW50ICs9ICdcXG5cXHRcXHRzcmNzZXQ9XCInO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBkYXRhLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICBpbWFnZUVsZW1lbnQgKz0gJ1xcblxcdFxcdFxcdCcgKyBkYXRhW2ldLlVybCArICcgJyArIGRhdGFbaV0uU2l6ZSArICd3JztcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoaSA8IChkYXRhLmxlbmd0aCAtIDEpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaW1hZ2VFbGVtZW50ICs9ICcsJztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgaW1hZ2VFbGVtZW50ICs9ICdcIic7XHJcbiAgICAgICAgICAgIGltYWdlRWxlbWVudCArPSAnXFxuXFx0XFx0c3JjPVwiJyArIGxhcmdlc3RJbWFnZS5VcmwgKyAnXCIgYWx0PVwiJyArIGltYWdlLmFsdGVybmF0ZVRleHQgKyAnXCIgLz4nO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgaHRtbCArPSAnXFx0JyArIGltYWdlRWxlbWVudDtcclxuICAgICAgICAgICAgaHRtbCArPSAnXFxuPC9zZWN0aW9uPic7XHJcbiAgICAgICAgICAgIG9uUmVuZGVySHRtbChodG1sKTtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBVc2VzIHNlbGVjdGVkIG1lZGlhIHRvIHNldCBIVE1MLlxyXG4gICAgICovXHJcbiAgICB2YXIgc2V0SHRtbCA9IGZ1bmN0aW9uIChtZWRpYSkge1xyXG4gICAgICAgIGlmICghbWVkaWEgfHwgbWVkaWEubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZhciBvblJlbmRlckh0bWwgPSBmdW5jdGlvbiAoaHRtbCkge1xyXG4gICAgICAgICAgICAkaW5wdXQudmFsKGh0bWwpO1xyXG4gICAgICAgICAgICAkaW5wdXRbMF0uZGlzcGF0Y2hFdmVudChuZXcgRXZlbnQoJ2NoYW5nZScpKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBpZiAobWVkaWEubGVuZ3RoID09PSAxICYmIG1lZGlhWzBdLmNvbnRlbnRUeXBlID09PSBDT05URU5UX1RZUEVfSU1BR0UpIHtcclxuICAgICAgICAgICAgcmVuZGVyU2luZ2xlSW1hZ2UobWVkaWFbMF0sIG9uUmVuZGVySHRtbCk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICBhZGRMaXN0ZW5lcnMoKTtcclxufSkoKTsiXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
